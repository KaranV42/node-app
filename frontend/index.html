<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Vite App</title>
</head>
<body>
    <div class="centered">
        <h2>Payment Authorization</h2>
        <form id="paymentForm" onsubmit="return authorizePayment(event);">
            <input type="text" id="amount" name="amount" placeholder="Enter Amount" required>
            <input type="text" id="currency" name="currency" placeholder="Enter Currency (e.g., USD)" required>
            <button type="submit">Authorize Payment</button>
        </form>
        <p id="errorMessage"></p>
    </div>

    <div class="acuity-container">
        <h2>Book an Appointment</h2>
        <iframe src="https://app.acuityscheduling.com/schedule.php?owner=31522164&ref=embedded_csp" title="Schedule Appointment" width="200%" height="50%" frameborder="0" style="overflow: visible"></iframe>

        <script src="https://embed.acuityscheduling.com/js/embed.js" type="text/javascript"></script>

        <div class="acuity-booking-bar" style="display: none;">
            100%K9
            <a href="https://app.acuityscheduling.com/schedule.php?owner=31522164&ref=booking_bar" target="_blank" class="acuity-embed-button">Schedule Appointment</a>
        </div>
        <script src="https://embed.acuityscheduling.com/embed/bar/31522164.js" async></script>
    </div>

    <script type="module">
        import currencyCode from 'currency-code';
    
        async function authorizePayment(event) {
            event.preventDefault();
            const amount = document.getElementById('amount').value;
            const currency = document.getElementById('currency').value.toUpperCase();
            const errorMessage = document.getElementById('errorMessage');
    
            errorMessage.textContent = '';
    
            const validAmount = !isNaN(amount) && amount > 0;
            const validCurrency = currencyCode.isValid(currency);
    
            if (validAmount && validCurrency) {
                try {
                    const response = await fetch('', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ amount, currency }),
                    });
    
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
    
                    const data = await response.json();
                    console.log('Payment authorized:', data);
                } catch (error) {
                    errorMessage.textContent = 'Failed to authorize payment: ' + error.message;
                }
            } else {
                errorMessage.textContent = 'Invalid amount or currency. Please check your input.';
            }
        }
    </script>
</body>
</html>
